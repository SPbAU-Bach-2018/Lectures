% начало доказательства в 11.tex

		Пусть $\sigma$ "--- сигнатура $\Gamma'$ (экзистенциально расширенного списка $\Gamma$).
		Скажем, что носитель модели "--- это множество замкнутых термов сигнатуры $\sigma$.
		Теперь надо определить функции и предикаты.
		\begin{Rem}
			Осторожно, не запутайтесь дальше (есть шанс, что автор конспекта сам запутался):
			когда мы говорим <<терм>> и подставляем термы, то мы можем это делать в двух смыслах:
			либо <<терм>> в смысле <<элемент носителя>> и подстановки переменной, либо
			нормальная подстановка некоторого терма в формулу.
		\end{Rem}

		Рассмотрим функцию $f^{(n)} \in \sigma$ из сигнатуры.
		Капитан Очевидность предлагает определить их вот так:
		\[ [f^{(n)}](t_1, \dots, t_n) = f^{(n)}(t_1, \dots, t_n) \]
		То есть если применяем функциональный символ к термам $t_1, \dots, t_n$,
		то мы получаем терм вида <<$f^{(n)}(t_1, \dots, t_n)$>> (он тоже вполне себе замкнутый).

		Теперь возьмём предикатный символ $p^{(k)} \in \sigma$.
		Определим его значения на термах так:
		\[
			[p^{(k)}](t_1, \dots, t_n) =
			\begin{cases}
				1, &\text{если } \Gamma' \vdash p^{(k)}(t_1, \dots, t_n) \\
				0, &\text{если } \Gamma' \vdash \lnot p^{(k)}(t_1, \dots, t_n) \\
			\end{cases}
		\]
		Так как $\Gamma'$ полон, то все значения определены.

		Получили некоторую интерпретацию $I$: носитель и формулы.
		\begin{assertion}
			Для любой замкнутой формулы $\phi$ сигнатуры $\sigma$ верно:
			$\Gamma' \vdash \phi$ $\iff$ $\phi$ истинна в интерпретации $I$.
		\end{assertion}
		\begin{proof}
			Индукция по числу логических операций в $\phi$ ($\land, \lor, \lnot, \to, \exists, \forall$).
			База: атомарные формулы. Для них мы просто по определению $I$ всё корректно задали.

			Переход: надо разобраться со значками (доказательство аналогично утверждению \ref{interpret_eq_derivability_non_pred},
  			там мы пользовались только полнотой, даже экзистенциальность не нужна):
			\begin{itemize}
				\item $\Gamma' \vdash (\phi \land \psi) \iff \Gamma' \vdash \phi$ и $\Gamma' \vdash\psi$
				\item $\Gamma' \vdash (\phi \lor \psi) \iff \Gamma' \vdash \phi$ или $\Gamma' \vdash\psi$
				\item $\Gamma' \vdash \phi \iff \Gamma' \nvdash \phi$
				\item $\Gamma' \vdash (\phi \to \psi) \iff \Gamma' \nvdash \phi$ или $\Gamma' \vdash \psi$
			\end{itemize}

			Остались кванторы.
  			\begin{description}
  			\item[$\exists$]
   			Допустим, что $\Gamma' \vdash \exists \colon \phi(x)$.
			Надо доказать, что эта формула истинна в нашей интерпретации.
				Мы знаем, что имеется экзистенциальная полнота $\Gamma'$, то есть
				имеется такой замкнутый терм $t$ такой, что $\Gamma \vdash \phi(t|x)$.
				По предположению индукции $\phi(t|x)$ истинна (так как квантор сняли,
				а никаких новых связок не добавили), что и требовалось.

				Теперь в обратную сторону: пусть $\exists x \colon \phi(x)$ истинна в интерпретации
				$I$, тогда существует некоторое значение $x$ (назовём его термом $t$) такой, что
				$\phi(t|x)$ истинна.
				То есть $\Gamma' \vdash \phi(t|x)$.
				Есть аксиома: $\phi(t|x) \to \exists x \colon \phi(x)$,
				По modus ponens аксиомы с $\phi(t|x)$ получаем $\Gamma' \vdash \exists x \colon \phi(x)$,
				что и требовалось.

			\item[$\forall$]
				Пусть $\Gamma' \vdash (\forall x \colon \phi(x))$.
				Есть аксиома: $(\forall x \colon \phi(x)) \to \phi(t|x)$.
				То есть для любого терма $t$ верно: $\Gamma' \vdash \phi(t|x)$ (по modus ponens),
				то есть $\phi(t|x)$ истинна, откуда $\forall x \colon \phi(x)$ истинна.

				В обратную сторону: пусть $\forall x \colon \phi(x)$ истинна в $I$.
				Доказательство от противного: пусть $\Gamma' \nvdash (\forall x \colon \phi(x))$,
				тогда $\Gamma' \vdash \lnot (\forall x \colon \phi(x))$.
				Мы уже проверяли, что выводима формула $\lnot (\forall x \colon \phi(x)) \to (\exists x \colon \lnot \phi(x))$.
				По modus ponens выводим $\exists x \colon \lnot \phi(x)$.
				Теперь по предыдущему пункту доказательства можем снять $\exists$ и обнаружить,
				что существует такой замкнутый терм $t$, что $\lnot \phi(t|x)$ истинна,
				то есть $\phi(t|x)$ ложна.
				Отсюда $\forall x \colon \phi(x)$ ложно (так как существует терм $x$, для
				которого подстановка ложна), противоречие.
			\end{description} 
		\end{proof}
	\end{description}
\end{proof}
\begin{conseq}
	Если $\phi$ общезначна, то $\phi$ выводима.
\end{conseq}
\begin{proof}
	Введём $\tilde \phi$ "--- заменяем все свободные переменные на новые константы
	(это чисто синтаксическая операция: никаких носителей еще нет, никаких значений функций на них задавать не надо).
	Выводимость от этого не меняется.
	Теперь рассмотрим список из одной (теперь уже замкнутой) формулы $\{ \lnot \tilde \phi \}$.
	Он либо противоречив, либо непротиворечив.

	Если противоречив, то для какой-то $A$:
	\[
		\begin{cases}
			\lnot \tilde \phi \vdash A \\
			\lnot \tilde \phi \vdash \lnot A
		\end{cases}
	\]
	У нас было правило вывода для рассмотрения от противного: если из $x$ выводится
	и $A$, и $\lnot A$, то из пустого выводится $\lnot x$.
	Еще было правило снятия двойного отрицания:
	\[
		\begin{cases}
			\vdash \lnot \lnot \tilde \phi \\
			\lnot\lnot \tilde \phi \vdash \tilde \phi \
		\end{cases}
		\Ra
		(\vdash \tilde \phi)
	\]
	Что и требовалось.

	Если непротиворечив, то есть модель $I$.
	Однако в этой модели мы получаем, что $\tilde \phi$ ложно,
	то есть она точно не общезначна.
	Значит, $\phi$ ложна, противоречие.
\end{proof}

\begin{theorem}[о компактности исчисления предикатов]
	$\Gamma$ "--- список замкнутых формул.
	Пусть любое конечное подмножество $\Gamma$ имеет модель.
	Тогда $\Gamma$ тоже имеет модель.
\end{theorem}
\begin{proof}
	Пусть $\Gamma$ не имеет модели.
	Тогда он противоречив, то есть можно вывести и некоторую формулу, и её отрицание.
	В выводе используется лишь конечное множество формул из $\Gamma$.
	То есть имеется некоторое конечное противоречивое подмножество $\Gamma$,
	которое, как мы знаем, не имеет модели.
	Противоречие.
\end{proof}
\begin{Rem}
	Это некоторый удобный способ доказывать существования моделей у списков формул.
\end{Rem}

\begin{Rem}
	Теперь мы знаем, что общезначимость формулы можно доказать с помощью формального вывода.
\end{Rem}

\subsection{Подготовка к алгоритму проверки}
Уже можно придумать полуразрешающий алгоритм для проверки формулы на тавтологичность,
перебирающий все формальные выводы и проверяющий, не вывелась ли формула.
Но это очень-очень долго.

Если у нас есть пропозициональная формула (без кванторов), то жить лучше: можно либо перебрать
значения переменных, либо скачать SAT-Solver.

С кванторами хуже.
Давайте сначала приведём формулу в предварённую (предварённую нормальную) форму, когда
все кванторы идут в начале.

Формулы классифицируют по количеству \textsl{смен} кванторов, как в арифметической иерархии, например:
\begin{gather*}
	(\exists \dots \exists \colon \phi) \in \Sigma_1 \\
	(\forall \dots \forall \colon \phi) \in \Pi_1 \\
	(\exists \dots \exists \forall \dots \forall \colon \phi) \in \Sigma_2 \\
	(\forall \dots \forall \exists \dots \exists \colon \phi) \in \Pi_2 \\
\end{gather*}

\begin{assertion}
	\[
		\forall x_1 \colon \dots \forall x_n \colon \phi(x_1, \dots, x_n)
	\]
	Эта формула общезначна тогда и только тогда, когда общезначна $\phi$.
\end{assertion}
\begin{proof}
	Очевидно, наверное.
\end{proof}

\begin{theorem}
	Бескванторная формула $\phi$ общезначна $\iff$ $\phi$ "--- частный случай
	пропозициональной тавтологии (то есть мы берём пропозициональную тавтологию
	и подставляем вместо переменных какие-то куски бескванторной формулы).
\end{theorem}
\begin{proof}
	\begin{description}
		\item[$\Ra$:]
			Уже было в древних примерах: пропозициональные тавтологии "--- частный случай тавтологий в исчислении предикатов.
			Если возьмём какую-нибудь тавтологию (например, $x \lor \lnot x$) и заменим переменные на что-то,
			то это всё еще останется истинным утверждением.
		\item[$\La$:]
			Выпишем все различные атомарные формулы (предикатный символ от каких-то функциональных),
			которые участвуют в бескванторной формуле: $P_1, P_2, \dots, P_n$ (все $P_i$ попарно различны как строки).
			Обозначим значение каждой атомарной формулы за некоторую булевскую переменную, получили
			какую-то пропозициональную формулу $\phi'$.
			Если она тавтология, то доказали, что надо.

			Пусть не тавтологие, то есть имеется какая-то подстановка $\alpha$ переменных, при которых
			значение $\phi'$ "--- ложь.
			Давайте придумаем интерпретацию формулы $\phi$, при которой она вычислится в ложь.
			Носителем возьмём замкнутые термы, функциональные символы определим естественным образом
			(как и раньше).
			А вот предикатные символы определим так, чтобы значения $P_i$ совпали с подстановкой
			$\alpha$: мы так можем сделать, так как все $P_i$ различны.
			Те значения предикатных символов, которые так не определились, определим произвольно "--- они ни на что не повлияют.
			Таким образом получили интерпретацию, в которой исходная формула $\phi$ ложна, то есть она не общезначна, противоречие.

			\begin{exmp}
				Возьмём какую-нибудь бескванторную формулу:
				\[ P_1(f(x), g(y)) \to ((P_1(f(x), g(y)) \land P_2(y)) \]
				У нас есть две разных атомарных формулы, введём переменные: $a=P_1(f(x), g(y))$, $b=P_2(y)$.
				Получили пропозициональную формулу:
				\[ a \to (a \land b) \]
				Эта формула тавтологией не является, например, при $a=1$ и $b=0$ она неверна.

				Тогда можно построить интерпретацию исходной формулы, в которой она будет неверна.
			\end{exmp}
	\end{description}
\end{proof}

\begin{theorem}[Эрбрана]
	Следующие утверждения эквивалентны:
	\begin{enumerate}
		\item
			Замкнутая $\Sigma_1$-формула (у которой в начале идут только $\exists$) от $n$ переменных общезначна
		\item
			Существует некоторое множество замкнутых термов:
			\[
			\begin{array}{ccc}
			t_1^{(1)} & \dots & t_n^{(1)} \\
			t_1^{(2)} & \dots & t_n^{(2)} \\
			\vdots & \ddots & \vdots \\
			t_1^{(k)} & \dots & t_n^{(k)} \\
			\end{array}{ccc}
			\]
			такая, что общезначна следующая конечная дизъюнкция:
			\[
				\Lor_{i=1}^k
					\phi(t_1^{(i)}\mid x_1, t_2^{(i)} \mid x_2, \dots, t_n^{(i)} \mid x_n)
			\]
	\end{enumerate}
\end{theorem}
\begin{proof}
	\begin{description}
		\item[$\Ra$:]
			пусть имеется конечная дизъюнкция и набор термов.
			Возьмём произвольную интерпретацию формулы, давайте по очереди попробуем
			для каждого $i$ взять такие значения $x_1, \dots, x_n$:
			$x_1=t_1^{(i)}, x_2=t_2^{(i)}, \dots$.
			Хотя бы один набор выполнит исходную формулу, что и требовалось.
		\item{$\La$:}
			Рассморим бесконечное множество $A$ формул $\{ \lnot \phi(t_1 \mid x_1, t_2 \mid x_2, \dots, t_n \mid x_n) \}$
			для всех возможных $t_1, \dots, t_n$ (где $t_i$ "--- замкнутые термы).
			Два случая:
			\begin{enumerate}
				\item
					Множество $A$ противоречиво.
					Значит, противоречие можно вывести из конечного числа формул,
					то есть конъюнкция некоторого конечного числа отрицаний $\phi$ есть противоречие.
					По правилу де Моргана можно вынести отрицание наружу, получить общезначную дизъюнкцию.
				\item
					Множество $A$ непротиворечиво, то есть совместно.
					Тогда существует модель $I$ с носителем $M$, которая выполняет все формулы $A$.
					Давайте рассмотрим множество $M' \subseteq M$ "--- множество значений всех
					замкнутых термов.
					Можно сузить модель $I$ до множества $M'$ (так как функциональные символы из $M'$
					не выводят), получить $I'$.

					А в $I'$ формула $\exists x_1 \colon \dots \exists x_n \colon \phi(\dots)$ ложна,
					так как любой $x_i$ имеет значение какого-то терма, то есть $\phi(\dots)$ всегда
					будет являться формулой из модели $I'$, а эта модель выполняет все $\lnot \phi(\dots)$,
					то есть $\phi(\dots)$ точно ложна.
			\end{enumerate}
	\end{description}
\end{proof}

\subsection{Сколемизация}
\begin{Def}
	Пусть была формула:
	\[ \forall x_1 \colon \exists x_2 \colon \forall x_3 \colon \exists x_4 \colon \dots \]
	Давайте вычеркнем $\exists x_2$ и заменим $x_2$ везде в формуле на $f_1(x_1)$,
	так как $x_2$ зависит только от $x_1$.
	$x_4$ заменим на $f_2(x_1, x_3)$ и так далее.
	Результат называется сколемизацией.

	Здесь функции $f_1$, $f_2$ "--- какие-то новые, которых раньше не было.

	Если квантор существования идёт в самом начале, то добавляется функция с нулём аргументов.
\end{Def}
\begin{assertion}
	$\phi$ выполнима $\iff$ её сколемизация $\tilde \phi$ выполнима.
	Заметим, что тут не эквивалентность, а выполнимость.
\end{assertion}
\begin{proof}
	Детали были оставлены в качестве упражнения.
	Идея: в конкретной интерпретации задаём значения функций $f_1, f_2, \dots$ по индукции, после обработки первых кванторов
	значение функции "--- в точности то, что выполнит остаток формулы (оно либо существует из-за квантора всеобщности, либо задаём произвольным).
\end{proof}
\begin{Rem}
	$\phi$ общезначна
	$\iff$ $\lnot \phi$ не выполнима
	$\iff$ $\widetilde{\lnot \phi}$ не выполнима
	$\iff$ $\underbrace{\lnot \widetilde{\lnot \phi}}_{\in \Sigma_1}$ общезначна.

	Тут мы свели определение общезначности к теореме Эрбрана.
	\TODO да ладно?
\end{Rem}

\section{Теории и модели}
\begin{Def}
	Теория "--- это множество замкнутых формул.
\end{Def}
\begin{Def}
	Модель называется \textsl{нормальной}, если имеется двухместный предикатный символ \t{=},
	обозначающий точное совпадение элементов носителя интерпретации.
	При этом выполняются аксиомы отношения эквивалентности:
	\begin{enumerate}
		\item Рефликсивность: $a=a$
		\item Симметричность: $a = b \iff b = a$
		\item Транзитивность: $a = b \land b = c \Ra a = c$
		\item
			Согласованность с функциональными символами: если $x_1=y_1$, $x_2=y_2$, \dots, $x_k=y_k$,
			то $f(x_1, \dots, x_k) = f(y_1, \dots, y_k)$.
		\item
			Согласованность с предикатными символами: если $x_1=y_1$, $x_2=y_2$, \dots, $x_k=y_k$,
			то $p(x_1, \dots, x_k) \Ra p(y_1, \dots, y_k)$.
			Обратная стрелочка получается автоматически из симметричности.
	\end{enumerate}
\end{Def}
\begin{theorem}[о полноте для нормальной модели]
	Теория $T$ с предикатом \t{=} имеет нормальную модель $\iff$ $T$ непротиворечива, если
	к ней добавить все аксиомы равенства.
\end{theorem}
\begin{proof}
	\begin{description}
		\item[$\Ra$:]
			Если есть нормальная модель, то в ней аксиомы выполняются, то есть, $T$ с добавленными аксиомами совместна $\iff$ непротиворечива.
		\item[$\La$:]
			Если непротиворечива, то есть модель $M$.
			В ней \t{=} является некоторым отношением эквивалентности (возможно, <<склеивающим>> некоторые элементы и не подходящим под определение нормальной модели).
			Тогда определим новую интерпретацию: $M/=$ (фактор по отношению эквивалентности, функции и предикаты
			получится однозначно определить из аксиом).
			Эта модель получится нормальной моделью.
	\end{description}
\end{proof}
\begin{conseq}[теорема о компакности для нормальных моделей]
	Пусть $T$ "--- теория с равенством.
	Если любая конечная подтеория имеет нормальную модель, то и $T$ имеет нормальную модель.
\end{conseq}
\begin{proof}
	Упражнение, оно должно в точности повторять доказательство предыдущей теорему о компактности.
\end{proof}

\begin{theorem}[Лёвенгейма-Сколема]\label{lowenheim}
	Если сигнатура теории не более чем счётна, то эта теория имеет не более чем счётную модель.
\end{theorem}
\begin{proof}
	Следует из доказательства теоремы о полноте: всякие там множества термов не более чем счётны
	(так как сигнатура не более чем счётна) и так далее, явно построим модель.
\end{proof}
\begin{Rem}
	Мы знаем, что множество вещественных чисел несчётно.
	Однако же по предыдущей теореме у нас теория вещественных чисел имеет не более чем счётную модель.

	Разрешение парадокса: когда мы доказывали несчётность вещественных чисел, мы жили
	<<внутри>> теории множеств (скажем, ZFC) и там доказывали всякое.
	Однако у ZFC есть счётная модель, а что мы там внутри доказываем "--- неважно.

	То есть <<счётное>>/<<несчётное>> у нас двух видов.

	\textbf{Это надо знать на пятёрку на экзамене.}
\end{Rem}

\begin{assertion}
	Пусть $Th(\No, 0, 1, +, \times, =)$ "--- множество замкнутых формул,
	истинных в арифметике.

	Существует счётная модель этой теории, неизоморфная $\No$.
\end{assertion}
\begin{proof}
	Давайте допишем новую константу: $c$, допишем счётное число утверждений вида $c \neq 0$, $c \neq 1$, $c \neq 2$, \dots.
	Любое конечное подмножество новой теории имеет нормальную модель, так как мы из новых утверждений
	возьмём лишь конечное число утверждений, т.е. можно подобрать значение $c \in \No$.
	Значит по теореме о компактности есть какая-то нормальная модель для всей теории.

	Однако носитель $S$ этой модели не может быть изоморфен натуральным числам.
	В самом деле: если изоморфен, то $c$ изоморфно какому-то числу $a \in \No$,
	но такого быть не может: у нас, в частности, есть условие $c \neq a$.
\end{proof}
