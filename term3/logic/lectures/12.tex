% начало доказательства в 11.tex

		Пусть $\sigma$ "--- сигнатура $\Gamma'$ (экзистенциально расширенного списка $\Gamma$).
		Скажем, что носитель модели "--- это множество замкнутых термов сигнатуры $\sigma$.
		Теперь надо определить функции и предикаты.
		\begin{Rem}
			Осторожно, не запутайтесь дальше (есть шанс, что автор конспекта сам запутался):
			когда мы говорим <<терм>> и подставляем термы, то мы можем это делать в двух смыслах:
			либо <<терм>> в смысле <<элемент носителя>> и подстановки переменной, либо
			нормальная подстановка некоторого терма в формулу.
		\end{Rem}

		Рассмотрим функцию $f^{(n)} \in \sigma$ из сигнатуры.
		Капитан Очевидность предлагает определить их вот так:
		\[ [f^{(n)}](t_1, \dots, t_n) = f^{(n)}(t_1, \dots, t_n) \]
		То есть если применяем функциональный символ к термам $t_1, \dots, t_n$,
		то мы получаем терм вида <<$f^{(n)}(t_1, \dots, t_n)$>> (он тоже вполне себе замкнутый).

		Теперь возьмём предикатный символ $p^{(k)} \in \sigma$.
		Определим его значения на термах так:
		\[
			[p^{(k)}](t_1, \dots, t_n) =
			\begin{cases}
				1, &\text{если } \Gamma' \vdash p^{(k)}(t_1, \dots, t_n) \\
				0, &\text{если } \Gamma' \vdash \lnot p^{(k)}(t_1, \dots, t_n) \\
			\end{cases}
		\]
		Так как $\Gamma'$ экзистенциально полон, то все значения определены.

		Получили некоторую интерпретацию $I$: носитель и формулы.
		\begin{assertion}
			Для любой замкнутой формулы $\phi$ сигнатуры $\sigma$ верно:
			$\Gamma' \vdash \phi$ $\iff$ $\phi$ истинна в интерпретации $I$.
		\end{assertion}
		\begin{proof}
			Индукция по числу логических операций в $\phi$ ($\land, \lor, \lnot, \to, \exists, \forall$).
			База: атомарные формулы. Для них мы просто по определению $I$ всё корректно задали.

			Переход: надо разобраться со значками (доказательство аналогично какой-то прошлой теореме,
  			там мы пользовались только полнотой, даже экзистенциальность не нужна):
  			\begin{itemize}
   				\item $\Gamma' \vdash (\phi \land \psi) \iff \Gamma' \vdash \phi$ и $\Gamma' \vdash\psi$
   				\item $\Gamma' \vdash (\phi \lor \psi) \iff \Gamma' \vdash \phi$ или $\Gamma' \vdash\psi$
   				\item $\Gamma' \vdash \phi \iff \Gamma' \not\vdash \phi$
   				\item $\Gamma' \vdash (\phi \to \psi) \iff \Gamma' \not\vdash \phi$ или $\Gamma' \vdash \psi$
  			\end{itemize}

			Остались кванторы.
  			\begin{description}
  			\item[$\exists$]
   			Допустим, что $\Gamma' \vdash \exists \colon \phi(x)$.
			Надо доказать, что эта формула истинна в нашей интерпретации.
				Мы знаем, что имеется экзистенциальная полнота $\Gamma'$, то есть
				имеется такой замкнутый терм $t$ такой, что $\Gamma \vdash \phi(t \mid x)$.
				По предположению индукции $\phi(t \mid x)$ истинна (так как квантор сняли,
				а никаких новых связок не добавили), что и требовалось.

				Теперь в обратную сторону: пусть $\exists x \colon \phi(x)$ истинна в интерпретации
				$I$, тогда существует некоторое значение $x$ (назовём его термом $t$) такой, что
				$\phi(t \mid x)$ истинна.
				То есть $\Gamma' \vdash \phi(t \mid x)$.
				Есть аксиома: $\phi(t\mid x) \to \exists x \colon \phi(x)$,
				По modus ponens аксиомы с $\phi(t\mid x)$ получаем $\Gamma' \vdash \exists x \colon \phi(x)$,
				что и требовалось.

			\item[$\forall$]
				Пусть $\Gamma' \vdash \forall x \colon \phi(x)$.
				Есть аксиома: $\forall x \colon \phi(x) \to \phi(t \mid x)$.
				То есть для любого терма $t$ верно: $\Gamma' \vdash \phi(t \mid x)$,
				то есть $\phi(t\mid x)$ истинна, откуда $\forall x \colon \phi(x)$ истинна.

				В обратную сторону: пусть $\forall x \colon \phi(x)$ истинна в $I$.
				Доказательство от противного: пусть $\Gamma' \not \vdash \forall x \colon \phi(x)$,
				тогда $\Gamma' \not \vdash \lnot \forall x \colon \phi(x)$.
				Мы уже проверяли, что выводима формула $\lnot \forall x \colon \phi(x) \to \exists x \colon \lnot \phi(x)$.
				По modus ponens выводим $\exists x \colon \lnot \phi(x)$.
				Теперь по предыдущему пункту доказательства можем снять $\exists$ и обнаружить,
				что существует такой замкнутый терм $t$, что $\lnot \phi(t \mid x)$ истинна,
				то есть $\phi(t \mid x)$ ложна.
				Отсюда $\forall x \colon \phi(x)$ ложно (так как существует терм $x$, для
				которого подстановка ложна), противоречие.
			\end{description} 
		\end{proof}
	\end{description}
\end{proof}
\begin{conseq}
	Если $\phi$ общезначна, то $\phi$ выводима.
\end{conseq}
\begin{proof}
	Введём $\tilde \phi$ "--- заменяем все свободные переменные на новые константы
	(это чисто синтаксическая операция: никаких носителей еще нет, никаких значений функций на них задавать не надо).
	Выводимость от этого не меняется.
	Теперь рассмотрим список из одной (теперь уже замкнутой) формулы $\{ \lnot \tilde \phi \}$.
	Он либо противоречив, либо непротиворечив.

	Если противоречив, то для какой-то $A$:
	\[
		\begin{cases}
			\lnot \tilde \phi \vdash A \\
			\lnot \tilde \phi \vdash \lnot A
		\end{cases}
	\]
	У нас было правило вывода для рассмотрение от противного: если из $x$ выводится
	и $A$, и $\lnot A$, то из пустого выводится $\lnot x$.
	Еще было правило снятия двойного отрицания:
	\[
		\begin{cases}
			\vdash \lnot \lnot \lnot \tilde \phi \\
			\lnot\lnot \tilde \phi \vdash \tilde \phi \
		\end{cases}
		\Ra
		(\vdash \tilde \phi)
	\]
	Что и требовалось.

	Если непротиворечив, то есть модель $I$.
	Однако в этой модели мы получаем, что $\tilde \phi$ ложно,
	то есть она точно не общезначна.
	Значит, $\phi$ ложна, противоречие.
\end{proof}

\begin{theorem}[о компактности исчисления предикатов]
	$\Gamma$ "--- список замкнутых формул.
	Пусть любое конечное подмножество $\Gamma$ имеет модель.
	Тогда $\Gamma$ тоже имеет модель.
\end{theorem}
\begin{proof}
	Пусть $\Gamma$ не имеет модели.
	Тогда он противоречив, то есть можно вывести и некоторую формулу, и её отрицание.
	В выводе используется лишь конечное множество формул из $\Gamma$.
	То есть имеется некоторое конечное противоречивое подмножество $\Gamma$,
	которое, как мы знаем, не имеет модели.
	Противоречие.
\end{proof}
\begin{Rem}
	Это некоторый удобный способ доказывать существования моделей у список формул.
\end{Rem}

\begin{Rem}
	Теперь мы знаем, что общезначимость формулы можно доказать с помощью формального вывода.
\end{Rem}

\subsection{Алгоритм проверки}
Уже можно придумать полуразрешающий алгоритм для проверки формулы на тавтологичность,
перебирающий все формальные выводы и проверяющий, не вывелась ли формула.
Но это очень-очень долго.

Если у нас есть пропозициональная формула (без кванторов), то жить лучше: можно либо перебрать
значения переменных, либо скачать SAT-Solver.

С кванторами хуже.
Давайте сначала приведём формулу в предварённую (предварённую нормальную) форму, когда
все кванторы идут в начале.
Формулы классифицируют по количеству \textsl{смен} кванторов, как в исчислениях, например:
\[
	(\exists \dots \exists \colon \phi) \in \Sigma_1 \\
	(\forall \dots \forall \colon \phi) \in \Pi_1 \\
	(\exists \dots \exists \forall \dots \forall \colon \phi) \in \Sigma_2 \\
	(\forall \dots \forall \exists \dots \exists \colon \phi) \in \Sigma_2 \\
\]

\begin{assertion}
	\[
		\forall x_1 \colon \dots \forall x_n \colon \phi(x_1, \dots, x_n)
	\]
	Эта формула общезначна тогда и только тогда, когда общезначна $\phi$.
\end{assertion}

\begin{theorem}
	Бескванторная формула $\phi$ общезначна $\iff$ $\phi$ "--- частный случай
	пропозициональной тавтологии (то есть мы берём пропозициональную тавтологию
	и подставляем вместо переменных какие-то куски бескванторной формулы).
\end{theorem}
\begin{proof}
	\begin{description}
		\item[$\La$:]
			Уже было в древних примерах: пропозициональные тавтологии "--- частный случай тавтологий в исчислении предикатов.
			Если возьмём какую-нибудь тавтологию (например, $x \lor \lnot x$) и заменим переменные на что-то,
			то это всё еще останется истинным утверждением.
		\item[$\Ra$:]
			Выпишем все различные атомарные формулы (предикатный символ от каких-то функциональных),
			которые участвуют в бескванторной формуле: $P_1, P_2, \dots, P_n$ (все $P_i$ попарно различны как строки).
			Обозначим значение каждой атомарной формулы за некоторую булевскую переменную, получили
			какую-то пропозициональную формулу $\phi'$.
			Если она тавтология, то доказали, что надо.

			Пусть не тавтологие, то есть имеется какая-то подстановка $\alpha$ переменных, при которых
			значение $\phi'$ "--- ложь.
			Давайте придумаем интерпретацию формулы $\phi$, при которой она вычислится в ложь.
			Носителем возьмём замкнутые термы, функциональные символы определим естественным образом
			(как и раньше).
			А вот предикатные символы определим так, чтобы значения $P_i$ совпали с подстановкой
			$\alpha$: мы так можем сделать, так как все $P_i$ различны.
			Те значения предикатных символов, которые так не определились, определим произвольно "--- они ни на что не повлияют.
			Таким образом получили интерпретацию, в которой исходная формула $\phi$ ложна, то есть она не общезначна, противоречие.

			\begin{exmp}
				Возьмём какую-нибудь бескванторную формулу:
				\[ P_1(f(x), g(y)) \to ((P_1(f(x), g(y)) \land P_2(y)) \]
				У нас есть две разных атомарных формулы, введём переменные: $a=P_1(f(x), g(y))$, $b=P_2(y)$.
				Получили пропозициональную формулу:
				\[ a \to (a \land b) \]
				Эта формула тавтологией не является, например, при $a=1$ и $b=0$ она неверна.

				Тогда можно построить интерпретацию исходной формулы, в которой она будет неверна.
			\end{exmp}
	\end{description}
\end{proof}

\begin{theorem}[Эрбрана]
	Следующие утверждения эквивалентны:
	\begin{enumerate}
		\item
			Замкнутая $\Sigma_1$-формула (у которой в начале идут только $\exists$) от $n$ переменных общезначна
		\item
			Существует некоторое множество замкнутых термов:
			\[
			\begin{array}{ccc}
			t_1^{(1)} & \dots & t_n^{(1)} \\
			t_1^{(2)} & \dots & t_n^{(2)} \\
			\vdots & \ddots & \vdots \\
			t_1^{(k)} & \dots & t_n^{(k)} \\
			\end{array}{ccc}
			\]
			такая, что общезначна следующая конечная дизъюнкция:
			\[
				\Lor_{i=1}^k
					\phi(t_1^{(i)}\mid x_1, t_2^{(i)} \mid x_2, \dots, t_n^{(i)} \mid x_n)
			\]
	\end{enumerate}
\end{theorem}
\begin{proof}
	\begin{description}
		\item[$\Ra$:]
			пусть имеется конечная дизъюнкция и набор термов.
			Возьмём произвольную интерпретацию формулы, давайте по очереди попробуем
			для каждого $i$ взять такие значения $x_1, \dots, x_n$:
			$x_1=t_1^{(i)}, x_2=t_2^{(i)}, \dots$.
			Хотя бы один набор выполнит исходную формулу, что и требовалось.
		\item{$\La$:}
			Рассморим бесконечное множество $A$ формул $\{ \lnot \phi(t_1 \mid x_1, t_2 \mid x_2, \dots, t_n \mid x_n) \}$
			для всех возможных $t_1, \dots, t_n$ (где $t_i$ "--- замкнутые термы).
			Два случая:
			\begin{enumerate}
				\item
					Множество $A$ противоречиво.
					Значит, противоречие можно вывести из конечного числа формул,
					то есть конъюнкция некоторого конечного числа отрицаний $\phi$ есть противоречие.
					По правилу де Моргана можно вынести отрицание наружу, получить общезначную дизъюнкцию.
				\item
					Множество $A$ непротиворечиво, то есть совместно.
					Тогда существует модель $I$ с носителем $M$, которая выполняет все формулы $A$.
					Давайте рассмотрим множество $M' \subseteq M$ "--- множество значений всех
					замкнутых термов.
					Можно сузить модель $I$ до множества $M'$ (так как функциональные символы из $M'$
					не выводят), получить $I'$.

					А в $I'$ формула $\exists x_1 \colon \dots \exists x_n \colon \phi(\dots)$ ложна,
					так как любой $x_i$ имеет значение какого-то терма, то есть $\phi(\dots)$ всегда
					будет являться формулой из модели $I'$, а эта модель выполняет все $\lnot \phi(\dots)$,
					то есть $\phi(\dots)$ точно ложна.
			\end{enumerate}
	\end{description}
\end{proof}
