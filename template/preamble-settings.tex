
\setdefaultlanguage[spelling=modern,babelshorthands=true]{russian}
\setotherlanguage{english}

\defaultfontfeatures{Ligatures={TeX}}
\setmainfont{CMU Serif}
\setsansfont{CMU Sans Serif}
\setmonofont{CMU Typewriter Text}  
\setmathfont{Latin Modern Math}
\newcommand{\Setminus}{\mathbin{\backslash}}

\DeclareSymbolFont{cyrletters}{\encodingdefault}{\familydefault}{m}{it}
\newcommand{\makecyrmathletter}[1]{%
  \begingroup\lccode`a=#1\lowercase{\endgroup
  \Umathcode`a}="0 \csname symcyrletters\endcsname\space #1
}
\count255="409
\loop\ifnum\count255<"44F
  \advance\count255 by 1
  \makecyrmathletter{\count255}
\repeat
%% Simpy adds cyrillic to maths!

\frenchspacing

\def\la{\leftarrow}
\def\ra{\rightarrow}
\def\lra{\leftrightarrow}
\def\La{\Leftarrow}
\def\Ra{\Rightarrow}
\def\Lra{\Leftrightarrow}
\def\lrh{\leftrightharpoons}
\def\btu{\bigtriangleup}

\def\N{\mathbb{N}}
\def\Z{\mathbb{Z}}
\def\Q{\mathbb{Q}}
\def\R{\mathbb{R}}
\def\C{\mathbb{C}}
\def\d{\mathup{d}}

\def\LraDef{\stackrel{\mathrm{Def}}{\Lra}}
\def\eqDef{\stackrel{\mathrm{Def}}{=}}

\renewcommand{\le}{\leqslant}
\renewcommand{\ge}{\geqslant}
\renewcommand{\leq}{\leqslant}
\renewcommand{\geq}{\geqslant}

\DeclareMathOperator{\Int}{int}
\DeclareMathOperator{\cl}{cl}
\DeclareMathOperator{\diam}{diam}
\DeclareMathOperator{\Dom}{Dom}
\DeclareMathOperator{\coDom}{coDom}
\DeclareMathOperator{\Char}{char}
\DeclareMathOperator{\Arg}{Arg}
\AtBeginDocument{\let\Re\relax}
\AtBeginDocument{\newcommand{\Re}{\mathop{\mathrm{Re}}\nolimits}}
\AtBeginDocument{\let\Im\relax}
\AtBeginDocument{\newcommand{\Im}{\mathop{\mathrm{Im}}\nolimits}}
\newcommand{\emod}[1]{\mathop{\equiv}\limits_{#1}}
\newcommand{\Choose}[2]{{\left(#1 \atop #2\right)}}

\renewcommand{\thechapter}{\Roman{chapter}}
\renewcommand{\thesection}{\thechapter.\arabic{section}}

\theoremstyle{definition}
\newtheorem{theorem}{Теорема}[section]
\newtheorem{assertion}{Утверждение}[section]
\newtheorem{lemma}{Лемма}[section]

\newtheorem{Def}{$\mathfrak{Def}$}[section]

\theoremstyle{remark}
\newtheorem{conseq}{Следствие}[theorem]
\newtheorem{conseq*}{Следствие}
\newtheorem{Rem}{Замечание}[section]
\newtheorem{exmp}{Пример}[section]

\newcommand{\proofbegin}{$\blacktriangleright$}
\newcommand{\proofend}{$\blacktriangleleft$}

% http://tex.stackexchange.com/a/67740
\renewenvironment{proof}{%
	\begin{adjustwidth}{0pt}{\widthof{\proofend}}%
	\begin{description}[labelwidth=\widthof{\proofbegin},leftmargin=!]%
	\item[\proofbegin]%
}{%
    \hfill\makebox[0pt][l]{\proofend}
	\end{description}%
	\end{adjustwidth}%
}

\setcounter{MaxMatrixCols}{40}
\makeatletter
\def\tableofcontents{\section*{\contentsname}\@starttoc{toc}}
\makeatother

\gdef\LectureName{}

\AtBeginDocument{\newcommand{\BigHeader}[3]{%
	\thispagestyle{plain}
	\begin{center}
	\textbf{\Huge #1} \\
	\vspace{1.5em}
	\textbf{\large #2} \\
	\vspace{0.5em}
	\textbf{\large #3} \\
	\vspace{0.5em}
	{Собрано: \today~\currenttime} \\
	\end{center}

	\gdef\LectureName{#1}

    \hrulefill

    {
    \let\clearpage\relax
    \tableofcontents
    }
    \clearpage
}}

\pagestyle{fancyplain}
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
\renewcommand{\plainheadrulewidth}{0pt}
\renewcommand{\plainfootrulewidth}{0.4pt}

\lhead{\fancyplain{}{\LectureName}}
\rhead{\fancyplain{}{\rightmark}}

\cfoot{\thepage~из~\totalpages}
