\section{} % 10
Есть ориентированный граф, у ребра есть неотрицательная пропускная способность, есть две выделенных вершины $s$, $t$.
Поток "--- это функция из рёбер в вещественные числа, не теряется в вершинах.
Можно ввести обратные рёбра, тогда сумма в вершине должны быть нулём.
Величина потока "--- сумма по исходящим из истока.
Разрез: разбили на два множества ($s \in S$, $t\in T$), его величина "--- сумма способностей рёбер из $S$ в $T$ (не наоборот).
Величина потока через разрез равна потоку, то есть макс. поток не больше мин. разреза.
Циркуляция "--- поток нулевой величины.

Путь дополняющий из $s$ в $t$, если можно по нему увеличить поток.
Остаточная сеть: вычли из пропускных способностей текущий поток..
Теорема и алгоритм Форда-Фалкерсона: нет дополняющего пути в остаточной сети $\iff$ поток максимален (потому что можем предъявить разрез).
Если пропускные способности целые, то есть минимальный разрез, на каждом шаге ФФ увеличивает поток на целое, т.е. найдёт и по каждому ребру будет течь целое число.
Можно искать ФФ за $\O(|f|E)$, ЭК за $\O(VE^2)$ (со scaling за $\O(E^2 \log U)$), Диниц за $\O(V^2E)$ (со scaling за $\O(VE\log U)$), preflow push за $\O(V^3)$,
Ахьюдж за $\O(VE + V^2\log U)$.

\section{} % 11
Минимальный разрез по максимальному потоку: пустили итерацию ФФ, взяли достигнутые в одну долю.
Паросочетание "--- это целочисленный поток в специальном графе (между долями "--- бесконечности, в вершины "--- единицы).
Разрез в таком графе соответствует покрытию нашего двудольного графа (см. билет 2).
А теперь говорим, что в вершины рёбра идут пропускных способностей, равных стоимостям, наш минимальный разрез даст минимальное покрытие.

\section{} % 12
Эдмондс-Карп: нашли кратчайший путь (по числу рёбер), пустили по нему максимум возможного потока.
На каждой итерации до каждой вершини кратчайшее расстояние не уменьшается, а хотя бы одно ребро <<насыщается>>.
Чтобы ребро насытилось потом еще раз, надо по нему отменить поток, то есть до одного из концов расстояние должно увеличиться.
Итераций $\O(VE)$, всего $\O(VE^2)$.
Тут целые пропускные способности неважны, то есть максимальный поток есть всегда и его можно искать.
Scaling: ищем пути размера $2^k$, когда кончились "--- уменьшили $k$.
Время: на итерации по пути пропускаем не более $2^{k+1}$ $\Ra$ есть разрез величины не более $2^{k+1}E$, тогда он за $2E$ путей убьётся, итого $\O(E^2 \log U)$.
На вещественных надо спускаться до погрешности.

\section{} % 13
Диниц: почти Эдмондс-Карп, но толкает по куче путей за раз.
Построили слоистую сеть bfs'ом, протолкнули за $\O(E)$ по всем возможным кратчайшим путям (нашли "--- толкнули, повторить, выкидываем пустые рёбра).
После итерации расстояние до стока увеличивается.
Внутри итерации мы каждый раз либо выкидываем ребро, либо за $\O(V)$ находим дополняющий путь и насыщаем одно ребро из него,
то есть каждая итерация работает за $\O(E+KV)$, где $K$ "--- количество найденных путей (не более $E$).
Если добавить масштабирование (одним самым внешним циклом), то в сумме в одном запуске Диница мы сможем найти не более $2E$ дополняющих путей (за все итерации), то есть время
внутри одного масштабирования будет $\O(VE+2EV)$, итого $\O(VE\log)$.

\section{} % 14
Первая теорема: если $P=\sum \min(c_in, c_out)$, то Диниц выполнит $\O(\sqrt P)$ фаз.
Например, на единичных выполнит $\sqrt V$ фаз.
\TODO доказательство, вторая теорема
В нашем понимании Хопкрофт-Карп "--- это Диниц, работает за $\O(E \sqrt V)$.

\section{} % 15
Декомпозиция потока на пути и циркуляцию: нашли путь из $s$ в $t$, забрали с него минимум из потоков, одно ребро пересохло.
Это $\O(E^2)$.
Оптимизация итерации до $\O(V)$: начинаем интересоваться и циклами тоже (в цикле тоже можно забирать минимум из потоков),
итераций всё еще не более $\O(E)$, а цикл ищется за $\O(V)$ (потому что рёбра без потока можно выкидывать).
Поиск $k$ непересекающихся путей по рёбрам: пустили поток размера $k$, декомпозировали.
По вершинам: раздвоили вершину (на вход и выход), между входом и выходом ограничили поток единицей.
В неориентированных графах: либо у обратного ребра делаем пропускную способность один вместо нуля, либо просто добавляем еще одно ориентированное ребро (с еще одним обратным).
В любом случае надо аккуратно выписывать ответ: если по ребру прошли и туда, и обратно, то декомпозиция не поймёт, что на самом деле это ребро в потоке не участвует.
А вот найти непересекающуюся пару путей $A\to B$ и $C \to D$ "--- это NP.

\section{} % 16
Несколько истоков/стоков: добавили фиктивных $s'$ и $t'$, провели бесконечные рёбра.
Избытки/недостатки: у каждого истока есть избыток, у стока "--- недостаток, суммы равны, надо как-то перенаправить.
Тоже добавили фиктывные исток/сток, провели рёбра ширины в избыток/недостаток, нашли <<совершенный>> поток.
LR-циркуляция (есть ограничение на поток снизу): пустили по всем $L_e$, где-то оказались избытки/недостатки (а пропускные способности стали $R_e-L_e$), свели к предыдущей.
LR-поток: добавили бесконечное ребро $t \to s$, нашли циркуляцию.
Max LR-поток: пусть есть ответ $f$ и $f_0$ "--- какой-то LR-поток.
Тогда $f-f_0$ "--- поток в остаточной сети $G_{f_0}$ (в этой остаточной сети мы запрещаем отменять по обратным рёбрам поток так, чтобы он стал меньше $L$).
И наоборот, если $g$ "--- найденный поток в такой сети, то $f_0+g$ есть какой-то LR-поток.

\section{} % 17
Предпоток: в вершину может больше втекать, у вершины есть высота $0 \le h$, если есть ненасыщенное ребро $u \to v$, то $h_u \le h_v + 1$.
Изначально высота истока равна $n$, остальные "--- ноль, из истока рёбра насыщены.
Дальше берём какую-нибудь вершину с избытком, берём ненасыщенное ребро в вершину, которая строго ниже, толкаем по нему поток.
Если нет таких, а избыток есть "--- поднимаем вершину до максимально возможной высоты (чтобы ненасыщенные рёбра не поломались).
Высота вершины, из которой есть дополняющий путь в сток не более $n-1$ (потому что спускаемся не больше, чем на 1).
Если есть избыток, то в неё есть путь из истока (добавили фиктивных рёбер в сток для избытка, декомпозировали).
Высота любой вершины не больше $2n-2$ (если есть избыток, то есть путь из истока с потоком, есть путь в исток по ненасыщенным, перепад высот мал;
а избыток после подъёма всегда есть).
Если делать нечего "--- нет дополняющего пути по ненасыщенным (посмотрели на рёбра из истока: либо насыщенно, либо толкнули обратно с высоты $n+1$, тогда пути нет).
Если делать нечего "--- избыток только в истоке/стоке и нет доп.пути.
Останавливается, так как высоты ограничены и уменьшается потенциал <<избыток $\cdot$ высота>>.

Все подъёмы выполнятся за $\O(VE)$, насыщающих проталкиваний не более $\O(VE)$, сдвигов в списке рёбер (указатель на ненасыщенное) тогда тоже $\O(VE)$.
За куб: смотрим вершины как угодно по очереди, пытаемся сделать операцию.
Потенциал "--- макс. высота вершины с избытком (кроме истока), увеличивается только на число подъёмов.
За фазу (просмотр всех вершин без насыщения исходящих рёбер) потенциал уменьшается на единицу, если не было интересных событий, потому что избыток у самой верхней вершины исчезает.

\section{} % 18
High level: выбираем самую высокую вершину и смотрим только на неё, если она одна, то мы за просмотр или поднимем, или уберём избыток.
Если везёт, то будет $\O(n^2)$ просмотров и время работы $\O(nm)$, но (без доказательство) в худшем случае будетт $\O(n^2\sqrt m)$.
Global relabeling: $h_v \le d_v$ ($d_v$ "--- расстояние до стока по ненасыщенным или до истока, если сток недостижим).
Каждые $m$ элементарных операций запускаем, какие-то высоты увеличиваются, не более, чем в два раза замедлили, но работает хорошо.
\TODO Ahuja

\section{} % 19
\TODO
%Наивно: взяли вершину $a$, перебрали вершину из другой доли $b$, нашли между ними минимальный разрез, взяли глобальный минимум.
%Штор-Вагнер: берём 

\section{} % 20
У обратных рёбер стоимость равна $-c$.
Любой макс.поток "--- это какой-то макс.поток плюс циркуляция (потому что разность потоков "--- поток).
Минимальный поток размера $k$ ($k=\max$ --- тоже норм), можно просто минимизировать стоимость (независимо от мощности), можно искать циркуляцию ($|f|=0$).
Если хотим получить поток минимальной стоимости такого же размера, как уже есть, надо прибавить к нему минимальную циркуляцию.
Отсутствуют отрицательные по стоимости циклы в остаточной сети $\iff$ минимальная стоимость потока.
$\La$ очевидно, $\Ra$ так как стоимость разности потоков (текущего и оптимального) "--- разность стоимостей.

Алгоритм: нашли поток, ищем отрицательный цикл (Гольдбергом, ха-ха), пускаем циркуляцию.
У нас на каждой итерации стоимость уменьшается хотя бы на 1, то есть итераций не больше $|E| \cdot \max W \cdot \max C$.
Другой алгоритм: если отрицательных циклов нет и мы хотим увеличить поток, то можно просто найти кратчайший (по стоимости) путь и протолкнуть по нему, циклов не появится.
Кратчайший путь можно искать ФБ (так как могут быть отрицательные веса, привет от обратных рёбер).

\section{} % 21
Можно заменить ФБ на Дейкстру после отмены всех циклов, нужно только добавить потенциалов Джонсона: $c'_e = c + \phi_a - \phi_b$
(так, чтобы на кратчайших путях получились нулевые рёбра).
На итерации пустили Дейкстру, обновили потенциалы, пустили поток по кратчайшему пути, остаточная сеть поменялась, но потенциалы, внезапно, остались хорошими и всё еще не дают отрицательных рёбер.
Свести mincost max flow в mincost circulation можно, добавив ребро стоимостью в $-\infty$ из стока в исток, тогда сначала по цене будет выгодно брать как можно больше его, а потом уже оптимизировать цену внутри графа.

\section{} % 22
\TODO

\section{} % 23
\TODO
