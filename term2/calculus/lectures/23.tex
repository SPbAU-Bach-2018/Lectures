% Интегральная теорема о среднем
\setauthor{Егор Суворов}

\begin{theorem}[интегральная теорема о среднем]
	Пусть $f, g \colon E \to \R$, причём $f, g$ интегрируемы, $g \ge 0$
	и $f$ ограничена: $m \le f \le M$.
	Тогда существует $\lambda \in [m, M]$ такое, что $\lambda \int_E g = \int_E fg$
\end{theorem}
\begin{proof}
	Знаем, что $mg \le fg \le Mg$.
	Проинтегрируем, получим
	\[
	m \int_E g = \int_E mg \le \int_E fg \le \int_E Mg = M \int_E g
	\]
	\begin{itemize}
	\item
		Если $\int_E g=0$, то $\int_E fg = 0$ и нужное равенство тривиально.
	\item
		Если $\int_E > 0$, то $m \le \frac{\int_E fg}{\int_E g} \le M$, возьмём дробь за $\lambda$.
	\end{itemize}
\end{proof}

\begin{Def}
	Множество $E$ "--- линейно связное, если $\forall a, b \in E$
	существует ломаная, их соединяющая, и целиком лежащая в E.
	\begin{center}
	\input{23_connected}
	\end{center}
\end{Def}
\begin{conseq}\label{23_lin_conn}
	Пусть $K$ "--- линейно связный компакт (в одномерном случае "--- это только отрезки).
	Пусть также есть непрерывная $f \colon K \to \R$ и есть интегрируемая $g \colon K \to R$, $g \ge 0$.
	Тогда $\exists c \in K$ такая что $\int_K fg = f(c) \cdot \int_K g$.
\end{conseq}
\begin{proof}
	$f$ непрерывна на компакте, значит, принимает наибольшее и наименьшее значение.
	Пусть $f(a)$ "--- минимум, $f(b)$ "--- максимум.
	Тогда $\forall x \colon f(a) \le f(x) \le f(b)$.
	Подставим $m=f(a)$ и $M=f(a)$ в теорему.
	Получим, что $\exists \lambda \in [f(a), f(b)] \colon \int_K fg = \lambda \int_K g$.
	Теперь надо показать, что $\lambda$ "--- это значение функции в какой-то точке.

	В самом деле, возьмём ломаную, соединяющую точки $a$ и $b$.
	Давайте её как-нибудь запараметризуем.
	Пусть имеется $m$ звеньев, разобьём отрезок $[0,1]$ на $m$ непустых кусков, каждый кусок отобразим в звено.
	Например, отрезок $[\frac{k-1}{m}, \frac{k}{m}]$ отобразили в звено номер $k$.
	Получили некоторое $\gamma \colon [0,1] \to K$, отображающее на ломаную.
	Возьмём функцию $g(t)=f(\gamma(t))$.
	Она непрерывна, так как является композицией непрерывных функцией.
	То есть имеем непрерывную функцию $g \colon [0,1] \to \R$, причём $g(0)=f(a)$, $g(1)=f(b)$,
	значит, по теореме Больцано-Коши, она принимает все промежуточные значения, в частности, $\lambda$.
	Значит $\lambda=f(c)$ для некоторого $c$ на нашей ломаной.
\end{proof}
\begin{Def}
	Назовём $E$ связным (просто связным), если $E$ нельзя представить в виде дизъюнктного объединения двух множеств,
	каждое из которых одновременно и открыто, и замкнуто одновременно (открытость/замкнутость в $E$, не во всём $\R^n$).
\end{Def}
\begin{exmp}
	Пусть $E$ "--- это два замкнутых квадратика (обозначены синим).
	\begin{center}
	\input{23_two_squares}
	\end{center}
	Тогда каждый из квадратиков в $E$ открыт (потому что можно взять его плюс небольшую открытую границу; обозначено жёлтым)
	и замкнут (потому что является дополнением другого квадратика).
\end{exmp}
\begin{Exercise}
	Пусть $K$ "--- связный компакт, есть непрерывная $f \colon K \to \R$,
	есть интегрируемая $g \colon K \to \R$, $g \ge 0$.
	Тогда $\exists c \in K$ такая, что $\int_K fg = f(c) \int_K g$.
	Указание: заменить последний кусок доказательства, посмотрев в прошлый семестр на доказательство теоремы Больцано-Коши.
	Утверждается, что оно проходит ровно для связных множеств.
\end{Exercise}
\begin{conseq}
	Пусть $f : K \to \R$ непрерывна, $K$ "--- линейно связный компакт.
	Пусть $K$ измеримо мерой $\mu$.
	Тогда $\exists c \in K$ такое, что $\int_K f = f(c) \mu K$
\end{conseq}
\begin{proof}
	Возьмём $g \equiv 1$ и подставим в следствие \ref{23_lin_conn}.
\end{proof}
\begin{exmp}
	Связность существенна.
	Возьмём $K = [0,1] \cup [2,3]$ (компакт, измеримо) и такие $f$ и $g$:
	\begin{gather*}
	g(x) = 1 \\
	f(x) = \begin{cases}
		-1, & x \in [0,1] \\
		1, & x \in [2,3] \\
	\end{cases}
	\end{gather*}
	Заметим, что $\int_K fg = 0$, а $\int_K g$ = 2.
	Но $f(c) \int_K g = 2f(c) \neq 0$ при любом $c$.
\end{exmp}

\begin{theorem}[геометрический смысл многомерного интеграла]
	Пусть есть $f \colon E \to \R$, интегрируемая и ограниченная, а также $f \ge 0$ на $E \subset \R^n$.
	Возьмём $G \subset \R^{n+1}$ следующего вида: $\{ x_1, \dots, x_{n+1} \} \mid x=(x_1,\dots,x_n) \in E, 0 \le x_{n+1} \le f(x) \}$.
	Это, по сути, <<подграфик>> функции.
	Тогда $G$ измеримо и $\mu_{n+1} G = \int_E f$ (то есть интеграл "--- объём под графиком).
\end{theorem}
\begin{proof}
	Пусть $I = \int_E f$, зафиксируем некоторое $\epsilon > 0$.
	Возьмём $\delta > 0$ такое, что $|I-s_\tau(f)| < \epsilon$ и $|I - S_\tau(f)| < \epsilon$
	для любого разбиения $\tau$ мелкости не больше $\delta$.
	Здесь за $s_\tau$ и $S_\tau$ обозначены суммы Дарбу "--- нижняя и верхняя.
	Так как $f$ интегрируема, то такое $\delta$ должно быть.

	Возьмём некоторое $E_k \in \tau$.
	Приблизим его клеточными множествами $A_k$ и $B_k$ такими, что $A_k \subset E_k \subset B_k$,
	а также $\mu B_k - \mu A_k < \frac{\epsilon}{m(\tau)}$ (здесь $m(\tau)$ "--- число множеств $E_k$ в разбиении).
	Мы так можем выбрать, потому что $E_k$ измеримо.

	Теперь заводим множество $X_k = A_k \times [0, \inf_{E_k} f)$.
	И множество $Y_k = B_k \times [0, \sup_{E_k} f + \epsilon)$.
	Это клеточные множества.
	Теперь хочется сказать, что
	\[
	\underbrace{\bigcup_{k=1}^{m(\tau)} X_k}_{\mathcal{X}} \subset G \subset \underbrace{\bigcup_{k=1}^{m(\tau)} Y_k}_{\mathcal{Y}}
	\]
	% двумерная картинка, с n=1. Пусть A_k=E_k (для простоты)
	% Взяли A_k, нарисовали прямоугольник под графиком - это X_k
	% Взяли B_k (оно может чуть вылезать), нарисовали прямоугольник над графиком - это Y_k
	При этом по краям неравенства стоят клеточные множества.
	Мы зажали $G$ между какими-то клеточными множествами $\mathcal{X}$ и $\mathcal{Y}$.
	Сейчас поймём, что их меры несильно отличаются друг от другая.
	Давайте сначала оценим меру $\mathcal{Y}$:
	\newcommand{\mysum}{\sum_{k=1}^{m(\tau)}}
	\begin{gather*}
	\mu_{n+1} \left( \bigcup_{k=1}^{m(\tau)} Y_k\right)
	\le \mysum \mu_{n+1} Y_k
	= \mysum (\sup_{E_k} f + \epsilon) \mu_{n} B_k
	\le \mysum (\sup_{E_k} f + \epsilon) (\mu_{n} A_k + \frac{\epsilon}{m(\tau)}) = \\
	= \mysum (\sup_{E_k} f \underbrace{\mu_n A_k}_{\le \mu_n E_k} + \epsilon \mu_n A_k + \frac{\epsilon^2}{m(\tau)} + \sup_{E_k} f \cdot \frac{\epsilon}{m(\tau)})
	\le S_\tau(f) + \epsilon\mysum \mu A_k + \epsilon^2 + M\epsilon
	\end{gather*}
	% ололо, рассказать про $M$
	Так как $A_k \subset E_k$, а $E_k$ дизъюнктны, то $\mysum \mu A_k \le \mu (\cup E_k) = \mu E$.
	Теперь оценим $\epsilon < 1$ и заменим сумму Дарбу на интеграл (она не больше $I+\epsilon \le I+1$):
	\[
	\le S_\tau(f) + \epsilon(\mu E + M + 1)
	\le I + \epsilon(\mu E + M + 2)
	\]

	Дальше смотрим на $\mathcal{X}$.
	Мы знаем, что $X_k$ дизъюнктны, так как каждое из них есть <<надстройка>> над $A_k$, которые уже дизъюнктны.
	Поэтому:
	\begin{gather*}
	\mu_{n+1} \left( \bigcup_{k=1}^{m(\tau)} X_k \right)
	= \mysum \mu_{n+1} X_k
	= \mysum \inf_{E_k} f \cdot \mu_n A_k
	\ge \mysum \inf_{E_k} f \cdot (\mu_n E_k - \frac{\epsilon}{m(\tau)}) = \\
	= \mysum \inf_{E_k} f \cdot \mu_n E_k - \mysum \underbrace{\inf_{E_k} f}_{\le M} \cdot \frac{\epsilon}{m(\tau)}
	\ge s_\tau(f) - M \epsilon
	\ge I - (M+1)\epsilon
	\end{gather*}

	Давайте теперь собирать.
	Мы знаем, что $\mathcal{X} = \cup_{k=1}^{m(\tau)} X_k$ "--- клеточное, $\mu \mathcal{X} \ge I - (M+1)\epsilon$.
	Аналогично знаем, что $\mathcal{Y} = \cup_{k=1}^{m(\tau)} Y_k$ "--- клеточное, $\mu \mathcal{Y} \le I + \epsilon(M+2+\mu E)$.
	Меры $\mathcal{X}$ и $\mathcal{Y}$ отличаются на некоторую константу, зависяющую только от $f$ и $E$, умноженную на $\epsilon$.
	Можем сделать зазор сколь угодно маленьким.
	Также знаем, что $X \subset G \subset Y$.
	Отсюда знаем, что $G$ измеримо по критерию измеримости.
	Тогда можем написать неравенство на меры:
	\[
	I - (M+1)\epsilon \le \mu_{n+1}\mathcal{X} \le \mu_{n+1} G \le \mu_{n+1}\mathcal{Y} \le I + \epsilon(M+2+\mu_n E)
	\]
	Устремляем $\epsilon$ к нулю, получаем равенство $\mu_{n+1} G = I$.
\end{proof}

\begin{Def}
	Пусть $E \subset \R^n$ измеримо.
	Есть непрерывные функции $\phi, \psi \colon \cl E \to \R$,
	причём $\phi(x) \le \psi(x) \forall x \in E$.
	Тогда определим $X \subset \R^{n+1}$ вот так:
	\[
	X = \{ (x_1, \dots, x_n, x_{n+1} \mid x=(x_1, \dots, x_n) \in E, \phi(x) \le x_{n+1} \le \psi(x) \}
	\]
	Назовём $X$ элементарным множеством (обобщение криволинейной трапеции).
	% картинка: зажато 
\end{Def}
\begin{conseq}
	\begin{enumerate}
	\item Элементарное множество измеримо
	\item Конечное объединение элементарных множеств измеримо
	\end{enumerate}
\end{conseq}
\begin{proof}
	Второй пункт очевиден, потому что конечное объединение измеримых измеримо.
	Разберёмся с первым пунктом.

	$\cl E$ "--- компакт, потому что оно, очевидно, замкнуто и ограничено (так как в мере Жордана измеримые всегда ограничены).
	Возьмём $m = \min_{e \in \cl E} \{ \phi(x), \psi(x) \}$.
	Введём две неотрицательных функции $f(x) = \phi(x) - m$ и $g(x) = \psi(x) - m$, они еще и непрерывны.
	Значит, интегрируемы.
	Возьмём из теоремы множества $G_f$ и $G_g$.
	Они измеримы.
	Их разность $G_g \setminus G_f$ тогда тоже измерима.
	Теперь заметим, что $X=(G_g \setminus G_f) \cup \Gamma_f$ тоже измеримо (например, потому что $\Gamma_f$ "--- это граница измеримого $G_f$, то есть имеет меру ноль и заведомо измеримо).
	По смыслу мы вернули обратно график $f$, который выкинулся вместе с подграфиком.
	% картинка
	
	Теперь заметим, то $G_g$ "--- это $G_\psi$, сдвинутое вниз на $m$, аналогично для $G_f$ и $G_\phi$.
	Значит, $X$ имеет такую же меру, как и $G_\psi - G_\phi$ (потому что при сдвиге ячейки переходят в ячейки).
\end{proof}
\begin{conseq}
	Получили формулу для меры элементарного множества:
	\[
	\mu_{n+1} X = \int_E (\psi - \phi)
	\]
\end{conseq}
\begin{proof}
	В процессе доказательства предыдущего следствия (напомниаем, что $\phi \le \psi$:
	\begin{gather*}
	\mu_{n+1} G_g = \int_E g = \int_E \psi - m \mu E \\
	\mu_{n+1} G_f = \int_E f = \int_E \phi - m \mu E \\
	\mu_{n+1} (G_g \setminus G_f) = \mu_{n+1} G_g - \mu_{n+1} G_f = \int_E \psi - \int_E \phi = \int_E (\psi - \phi)
	\end{gather*}
\end{proof}

\begin{lemma}
	Пусть $\gamma$ "--- спрямляемая кривая в $\R^n$ ($n \ge 2$).
	Тогда $\gamma$ измерима, причём $\mu \gamma = 0$.
\end{lemma}
\begin{Rem}
	При $n=1$ мера равна длине отрезка, поэтому $n \ge 2$ существенно.
	Спрямляемость (конечность длины) тоже существенна, иначе есть безумная кривая Пеано, заметающая квадратик $[0,1]^2$ и, соответственно, имеющая меру один.
\end{Rem}
\begin{proof}
	Знаем, что $L(s) < +\infty$.
	Нарежем на $m$ кусочков длины $\frac{l(s)}{m}$.
	В каждой из $m+1$ точек (границ кусочков) возьмём ячейку с центром в этой точке и стороной $\frac{2l(s)}{m}$.
	% картинка
	Тогда эти ячейки покроют нашу кривую (так как из каждой точки ячейка покрывает соседние кусочки).
	Считаем сумму мер ячеек: $(m+1)\left(\frac{2l(s)}{m}\right)^n \to 0$.
\end{proof}
