\setauthor{Егор Суворов}

% Тут была теорема

\begin{proof}
	Хотим доказать (по определению дифференцируемости), что
	\begin{align*}
	f(a+h)&=f(a)+\left<\nabla f(a), h\right>+o(h) & \text{здесь $\left<a, b\right>$ "--- скалярное произведение}
	\end{align*}
	При этом $\nabla f$ мы уже знаем, поэтому остаётся:
	\[R(h)=f(a+h)-f(a)-\left<\nabla f(a), h\right> \stackrel{?}{=} o(h)\]
	Распишем скалярное произведение:
	\[\left<\nabla f(a), h\right> = \sum_{k=1}^n \partd{f}{e_k}(a) h_k\]
	Теперь покоординатно будем смотреть, что происходит.
	Положим $\vec{b_k} = (a_1+h_1, a_2+h_2, \dots, a_k+h_k, a_{k+1}, a_{k+2}, \dots, a_n)$
	(это мы сдвинулись на $h$ только по первым $k$ координатам).
	Очевидно, что:
	\begin{gather*}
		b_n = a + h \\
		b_0 = a \\
		f(a+h)-f(a)=f(b_n)-f(b_{n-1})+f(b_{n-1})-f(b_{n-2})+\dots+f(b_1)-f(b_0)
		           =\sum_{k=1}^n f(b_k)-f(b_{k-1})
	\end{gather*}
	\begin{alignat*}{2}
		f(b_k) - f(b_{k-1}) &= f(a_1+h_1, a_2+h_2, \dots, a_{k-1}+h_{k-1}, a_k+h_k&,& a_{k+1}, \dots, a_n) \\
		                    &- f(a_1+h_1, a_2+h_2, \dots, a_{k-1}+h_{k-1}, a_k    &,& a_{k+1}, \dots, a_n) \\
	\end{alignat*}

	Введём функцию одной переменной (заменили в $b_k$ координату $k$ на переменную):
	\[ F_k(t) = f(a_1+h_1, \dots, a_{k-1}+h_{k-1}, t, a_{k+1}, \dots, a_n) \]
	Заметим, что производная $F_k$ в окрестности $a_k$ "--- это в точности частная производная $f$ в окрестности $a$
	(мы вольны выбирать очень маленькое $h$ так, чтобы $f$ было дифференцируемо во всех $b_k$ по всем координатам).
	Значит можем написать формулу Лагранжа:
	\[
	\exists \theta_k \in [0, 1] \colon
	F_k(a_k+h_k) - F_k(a_k) = F'_k(a_k+\theta_kh_k)h_k
	                        = \partd{f}{e_k} (b_{k-1}+\theta_k h_k e_k) h_k
	\]
	Собираем обратно ($F_k(a_k+h_k) - F_k(a_k) = f(b_k) - f(b_{k-1})$):
	\begin{gather*}
	f(a+h) - f(a) = \sum_{k=1}^n \partd{f}{e_k} (b_{k-1}+\theta_k h_k e_k) h_k \\
	R(h) = \sum_{k=1}^n \left( \partd{f}{e_k} (b_{k-1}+\theta_k h_k e_k) h_k - \partd{f}{e_k}(a) h_k \right)
	\end{gather*}

	Теперь оцениваем $R(h)$.
	\begin{align*}
	R(h) &= \sum_{k=1}^n \left( \partd{f}{e_k} (b_{k-1}+\theta_k h_k e_k) - \partd{f}{e_k}(a) \right)h_k = \\
			 &= \left<\left(\partd{f}{e_1}(b_0+\theta_1 h_1 e_1) - \partd{f}{e_1}(a), \dots, \partd{f}{e_n}(b_{n-1}+\theta_n h_n e_n) - \partd{f}{e_n}(a) \right), h\right>
	\end{align*}
	По Коши-Буняковскому:
	\begin{gather*}
	|R(h)| \le \left( \sum_{k=1}^n \left( \partd{f}{e_k} (b_{k-1}+\theta_k h_k e_k) - \partd{f}{e_k}(a) \right)^2 \right)^{1/2} \|h\| \\
	R(h) \stackrel?= o(\|h\|) \iff \frac{|R(h)|}{\|h\|} \stackrel{?}{\to} 0 \\
	\sum_{k=1}^n \left( \partd{f}{e_k} (b_{k-1}+\theta_k h_k e_k) - \partd{f}{e_k}(a) \right)^2 \stackrel{?}{\to} 0
	\end{gather*}
	Осталось понять, что каждое слагамое стремится к нулю:
	\[
	\partd{f}{e_k} (b_{k-1}+\theta_k h_k e_k) - \partd{f}{e_k}(a) \stackrel{?}{\to} 0
	\]
	То есть надо понять, что разность $\partd{f}{e_k}$ в точках $b_{k-1}+\theta_k h_k e_k$ и $a$ стремится к нулю.
	Так как частная производная непрерывна в точке $a$, нам достаточно понять, что $b_{k-1}+\theta_k h_k e_k$ стремится к $a$:
	\begin{align*}
	b_{k-1}+\theta_k h_k e_k - a &= (a_1+h_1, \dots, a_{k-1}+h_{k-1}, a_k + \theta_k h_k, a_{k+1}, \dots, a_n) - (a_1, \dots, a_n) = \\
	                         &= (h_1, \dots, h_{k-1}, \theta_k h_k, 0, \dots, 0)
	\end{align*}
	Тогда длина этого вектора не больше, чем длина $h$, так как модуль каждой координаты не больше:
	первые $k-1$ совпадают, $k$-я не больше, следующие равны нулю.

\end{proof}
\begin{Rem}
	Эта теорема очень удобна для проверки дифференцируемости: иногда по определению муторно и долго, а частные производные посчитать и посмотреть просто.
\end{Rem}

\begin{exmp}
	Пусть $f(x, y) = \sqrt[3]{xy}$.
	Хотим понять, что с дифференцируемостью.
	Найдём частные производные:
	\begin{gather*}
	\partd{f}{x} (x, y) = \frac{\sqrt[3]y}{3\sqrt[3]{x^2}} \text{~при $x \ne 0$} \\
	\partd{f}{y} (x, y) = \frac{\sqrt[3]x}{3\sqrt[3]{y^2}} \text{~при $y \ne 0$} \\
	\end{gather*}
	Несложно понять, что если $x, y \ne 0$, то частные производные еще и непрерывны.
	То есть $f$ точно дифференцируема при $x, y \ne 0$.

	Теперь посмотрим на частную производную по $x$ при $x=0$:
	\begin{gather*}
	\partd{f}{x} (0, y) = \lim_{h \to 0} \frac{f(h, y) - f(0, y)}{h}
	                    = \lim_{h \to 0} \frac{\sqrt[3]{hy}}{h}
	                    = \lim_{h \to 0} \frac{\sqrt[3]{y}}{h^{2/3}}
	\end{gather*}
	То есть при $y=0$ получаем ноль, а при $y \ne 0$ частная производная не существует.
	Аналогично с производной по $y$:
	\[
	\partd{f}{y}(x, y) =
		\begin{cases}
			0, & x = 0 \\
			\text{не существует}, & x \ne 0
		\end{cases}
	\]
	То есть в точках $(0, y)$ ($y \ne 0$) и $(x, 0)$ ($x \ne 0$) дифференцируемости нет,
	так как нет даже частных производных.
	А вот про $(0, 0)$ мы ничего сказать не можем: частные производные там есть, но не непрерывны 
	(даже не заданы в окрестности).
	Поэтому условие теоремы не выполнено, но она на этот счёт ничего не говорит, надо проверять руками.

	Разбираемся по определению.
	\[
		f(h, k) = f(0, 0) + \underbrace{A}_\text{матрица}\cdot\begin{pmatrix}h\\ k\end{pmatrix} + o\left(\begin{vmatrix}h\\ k\end{vmatrix}\right) \\
	\]
	Так как $A$ "--- матрица из частных производных, то она тождественный ноль (так как частные производные нули).
	\begin{gather*}
		f(h, k) = f(0, 0) + o(\sqrt{h^2 + k^2}) \\
		\sqrt[3]{hk} \stackrel{?}{=} o(\sqrt{h^2+k^2})
	\end{gather*}
	При $h=k$ имеем $h^{2/3} \ne o(h)$, то есть это неверно и дифференцируемости в $(0, 0)$ нет.
	\end{exmp}

\begin{exmp}
	Мы уже знаем, что из непрерывности частных производных следует дифференцируемость.
	И знаем, что из дифференцируемости следует существование частных производных.
	Следует ли их непрерывность?
	Оказывается, что нет.

	Возьмём функцию:
	\[
	f(x, y) =
		\begin{cases}
			x^2 + y^2, & \text{если ровно одна из $x$, $y$ рациональна} \\
			0, & \text{если обе рациональны или обе иррациональны}
		\end{cases}
	\]
	Покажем, что она дифференцируема в $(0, 0)$.
	Легко заметить, что $f(x, y) = f(0, 0) + o(\sqrt{x^2+y^2})$ (при малых $x$, $y$),
	так как $f(x, y) \le (x^2 + y^2) = o(\sqrt{x^2+y^2})$.

	Покажем, что с частными производыми всё не очень хорошо
	Возьмём $y_0 \in \Q$:
	\[
		f(x, y_0) =
			\begin{cases}
				x^2 + y^2, & x \notin \Q, \\
				0, & x \in \Q
			\end{cases}
	\]
	Эта функция даже не непрерывна, и уж тем более не дифференцируема, то есть частные производные отсутствуют.
	Таким образом частных производных нет нигде, кроме $(0, 0)$ и совсем странно будет рассуждать про их непрерывность.
\end{exmp}
\begin{Rem}
	Вообще говоря, можно еще определить непрерывную дифференцируемость и вот там как раз получится равносильное условие.
\end{Rem}

\begin{Def}
	$f\colon D \to \R$ ($D \subset \R^n$), $a \in \Int D$ и $f$ дифференцируема в окрестности точки $a$.
	Если $\|\d_x f - \d_a f\| \to 0$ при $x \to a$, то $f$ "--- непрерывно дифференцируема в точке $a$.
	Перефразируя: есть дифференциал и он непрерывен.
\end{Def}

\begin{theorem}
	Пусть $f\colon D \to \R$, $D$ открыто.
	Тогда:
	$f$ непрерывно дифференцируема во всех точках
	$\iff$ 
	все частные производные $f$ существуют и непрерывны во всех точках.
\end{theorem}
\begin{proof}
	\begin{description}
	\item[$\Ra$]
		Пусть $f$ непрерывно дифференцируема в точке $a$.
		Это значит, что $f$ дифференцируема там же.
		То есть в окрестности имеются все частные производные.
		Осталось доказать их непрерывность

		\begin{gather*}
			 \partd{f}{e_k}(x) = \d_xf(e_k) \\
			 \left| \partd{f}{e_k}(x) - \partd{f}{e_k}(a) \right|
					 = |\d_x f(e_k) - \d_a f(e_k)| = \\
					 = |(\d_x f - \d_a f)(e_k)|
					 \le \underbrace{\|\d_x f - \d_a f\|}_{\to 0\text{, при~}x \to a} \cdot \underbrace{\|e_k\|}_{= 1}
		\end{gather*}
	\item[$\La$]
		Возьмём точку $a$.
		Так как частные производные существуют и непрерывны везде (и в окрестности точки $a$),
		то $f$ дифференцируема в точке $a$.

		Было когда-то утверждение: норма отображения не превосходит корня из суммы квадратов всех коэффициентов.

		Распишем в лоб:
		\[
		\|\d_x f - \d_a f\|^2 \le \sum_{k=1}^n \left( \partd{f}{e_k}(x) - \partd{f}{e_k}(a)	\right)^2 \to 0
		\]
		Стремится к нулю, так как частные производные непрерывны $\Ra$ каждое слагаемое непрерывно.
	\end{description}
\end{proof}
\begin{Rem}
	Если бы $R$ была векторозначной, то теорема была бы верна, только доказательство несколько
	усложнится и надо будет говорить про вообще все частные производные.
\end{Rem}

\section{Производные высших порядков}
\begin{Def}
	Пусть $f : D \to \R$ ($D \subset \R^n$), $a \in \Int D$.
	Пусть $g=\partd{f}{e_i}$ существует в окрестности точки $a$
	и у $g\colon \text{окрестность~}a \to \R$ существует частная производная
	$\partd{g}{e_j} (a)$.
	Тогда её называют второй частной производной, обозначения:
	\begin{itemize}
	\item $\frac{\partial^2 f}{\partial e_j \partial e_i}$.
		Порядок можно запомнить так: $\frac{\partial}{\partial e_i}$ "--- это операция над функцией.
		Если применим сначала одну, потом другую, то получим $\frac{\partial}{\partial e_j} \frac{\partial}{\partial e_i}$,
		а выше "--- укороченная запись.
	\item $f''_{x_ix_j}$
	\item $D_{x_jx_i}$
	\end{itemize}
\end{Def}
\begin{Rem}
	К сожалению, каноничного порядка индексов нет.
	Связано с тем, что обычно от порядка не зависит, за исключением специальных случаев.
\end{Rem}
\begin{Rem}
	Укороченная запись: $\frac{\partial^2 f}{\partial e_i \partial e_i} = \frac{\partial^2 f}{\partial e_i^2}$
\end{Rem}
В том же духе можно ввести производные третьего, четвертого и больших порядков.

\begin{exmp}
  Пусть $f(x, y) = x^y$ и $x>0$.
  Хотим посчитать вторые частные производные.
	\begin{gather*}
	\partd f x (x, y) = yx^{y-1} \\
	\partd f y (x, y) = \ln x x^y \\
	\partdd f y x (x, y) = \partd{}y(yx^{y-1}) = x^{y-1}+y\partd{}y(x^{y-1}) = x^{y-1}+y\ln x \cdot x^{y-1} \\
	\partdd f x y (x, y) = \partd{}x(\ln x \cdot x^y) = \frac 1 x \cdot x^y + \ln x \cdot \partd{}x(x^y) = x^{y-1}+\ln x \cdot yx^{y-1}
	\end{gather*}
	Вне зависимости от порядка значение второй частной производной совпало и это не случайность.
	Но так бывает не всегда.
\end{exmp}
\begin{exmp}
	\begin{gather*}
	f(x, y) =
		\begin{cases}
			xy \cdot \frac{x^2-y^2}{x^2+y^2}, & (x, y) \ne (0, 0) \\
			0, & (x, y) = (0, 0)
		\end{cases}
	\end{gather*}
	Посчитаем первые производные в точках, отличных от $(0, 0)$:
	\begin{gather*}
	\partd f x (x, y) = y \cdot \frac{x^2-y^2}{x^2+y^2} + xy \cdot \frac{2x(x^2+y^2)-2x(x^2-y^2)}{(x^2+y^2)^2}
	                  = y \cdot \frac{x^2-y^2}{x^2+y^2} + xy \cdot \frac{4xy^2}{(x^2+y^2)^2} \\
	\partd f y (x, y) = -x \cdot \frac{y^2-x^2}{y^2+x^2} - xy \cdot \frac{4x^2y}{(y^2+x^2)^2}
	\end{gather*}
	А в $(0, 0)$ производные ноль, так как $xy=o(\sqrt{x^2+y^2})$, а $\frac{x^2-y^2}{x^2+y^2}$ ограничено.

	Теперь считаем вторые производные в $(0, 0)$:
	\begin{gather*}
	\partdd f y x (0, 0) = \lim_{y\to 0} \frac{\partd f x (0, y) - \partd f x (0, 0)}{y}
	                     = \lim_{y\to 0} \frac{-y - 0}{y} = -1 \\
	\partdd f x y (0, 0) = \lim_{x\to 0} \frac{\partd f y (x, 0) - \partd f y (0, 0)}{x}
	                     = \lim_{x\to 0} \frac{x - 0}{x} = 1 \\
	\end{gather*}
	Видим, что не совпало.
\end{exmp}
\begin{Rem}
	В следующий раз будет теорема, рассказывающая о том, когда неважен порядок.
	Если есть функция двух переменных, то порядок неважен, если частные производные непрерывны.
	В последнем примере проблема была именно в этом.
\end{Rem}
