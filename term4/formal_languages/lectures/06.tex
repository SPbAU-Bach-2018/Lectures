\setauthor{Всеволод Степанов}

\subsection{Преобразования КС-грамматик}
Цель "--- как-то преобразовать грамматику так, чтобы потом можно было на нее удобно натравливать всякие алгоритмы.

\begin{enumerate}
\item
Удаление $\epsilon$-продукций: $A \to \epsilon$. Хотим сделать так, чтобы $\epsilon$ вообще нельзя было получить.

\begin{Def}
Нетерминал $A$ называется $\epsilon$-порождающим, если $A \xLongrightarrow{*} \epsilon$.

Процедура:
\begin{itemize}
\item
Если есть продукция $A \to \epsilon$, то $A$ "--- $\epsilon$-порождающий. Все такие продукции просто выкинем из грамматики.

\item
Если есть продукция $A \to A_1 \dots A_k$, где $\forall i \in [1; k] A_i$"---$\epsilon$-порождающий, то $A$ "--- $\epsilon$-порождающий.
\end{itemize}
\end{Def}

Для каждой продукции $A \to A_1 \dots A_n$ для каждой $S$ "--- подпоследовательности $[1; n]$, не совпадающей с $[1; n]$ такой, что $A_{S_i}$ "--- $\epsilon$-порождающие, сделаем новую продукцию:
$A \to A_{t_1} \dots A_{t_k}$, где $t_i$ пробегают все значения в $[1; n] \setminus S$.

Словами: в правой части продукции есть какие-то нетерминалы, посмотрим на те, из которых можно вывести в итоге $\epsilon$. 
Если мы действительно выведем $\epsilon$, то можно просто сказать, что у нас этот нетерминал просто и не появлялся. 
Таким образом, переберем те нетерминалы, которые в итоге просто исчезнут, выкинем их, допишем соответствующую продукцию без них.
\begin{Rem}
$A_i$ здесь могут быть как и нетерминалами, так и терминалами
\end{Rem}
\begin{Rem}
Стоит понимать, что мы сейчас внезапно могли получить экспоненциальный рост количества продукций: если была продукция $A \to BCDE$, при этом $B, C, E$ "--- $\epsilon$-порождающие, то сейчас
мы получили следующую продукцию: $A \to BD | CD | D | BCD | DE | BDE | CDE | BCDE$. 
Чуть позже мы с этим поборемся.
\end{Rem}

Была грамматика $G$, получили грамматику $G'$. Тогда верно: $L(G') = L(G) \setminus \{\epsilon\}$.

Просто аккуратно посмотрим на вывод, если мы какой-то нетерминал когда-то заменили на $\epsilon$, то можно просто найти момент, когда мы его получили и сказать, что в тот момент
мы использовали сокращенную продукцию без этого нетерминала.
При этом могли получить где-то раньше в итоге $\epsilon$, например, если все получившиеся из продукции нетерминалы превратились в $\epsilon$. 
Тогда просто опять повторим эту же штуку, понятно, что если в итоге получали не пустое слово, то все будет хорошо.

\begin{Rem}
Если очень хочется получить тот же самый язык, что и был, то просто для $S$ разрешают иметь продукцию $S \to \epsilon$.

Еще можно ввести новый стартовый символ $S'$, добавить продукции $S' \to \epsilon|S$.
\end{Rem}

Оценка на размер $G'$: $\O(|G| 2^{m})$, где $m$ "--- максимально возможная длина правой части продукции.
Выглядит страшно, но мы с этим в какой-то момент сможем побороться.

\item
Удаление цепных продукций: $A \to B$, $B$ "--- нетерминал.
Рассмотрим транзитивное замыкание цепных продукций: добавим продукцию $A \to B$, если существуют $A_0 \dots A_n\colon A_0 = A, A_n = B, A_i \to A_{i + 1} \in P, A_i \in N$.

Теперь для каждой цепной продукции $A \to B$ из замыкания и для каждой продукции $B \to W$, не являющейся цепной 
($W$ может быть терминалом, или же последовательностью терминалов и нетерминалов), создадим продукцию $A \to W$.
А все цепные продукции просто удалим.

\begin{exmp}
Были продукции $\\
A \to B \\
B \to C | b \\
C \to B | AB | c 
$

Тогда после удаления цепных продукций получим: $\\
A \to b | AB | c \\
B \to b | AB | c \\
C \to AB | c | b
$.

Кстати, можно применить какую-нибудь эвристику вида ``посмотрели теперь на продукции, увидели, что они для $A$ и $B$ совпадают, поэтому их можно склеить''.
\end{exmp}

Размер $G'$: $\O(|G| |N|)$.

\item
Удаление бесполезных символов (и терминалов и нетерминалов).

Символ $T \in \Sigma \cup N$ называется полезным, если он учавствует в выводе какого-то слова, то есть, $S \xLongrightarrow{*} \alpha T \beta \xLongrightarrow{*} w \in \Sigma^*$. 
При этом, $\alpha, \beta$ могут быть пустыми.
\begin{exmp}
$S \to PTR \\
T \to T
P \to p
R \to r$

Символ $T$ полезный, символы $P, R$ "--- нет.
\end{exmp}
Соответственно, бесполезные символы, которые не встречаются в выводах, можно удалить.

Сначала для каждого нетерминала $T$ проверим, что $\exists w \in \Sigma^*\colon T \xLongrightarrow{*} w$.

Если есть продукция $T \to w$, где $w \in \Sigma^*$, то говорим, что $T$ "--- порождающий (то есть, можно вывести из него какое-то слово из терминалов)
Терминальые символы формально тоже назовем порождающими.

$T \to W$, все нетерминалы в $W$ порождающие, то $T$ тоже порождающий.                                              

Удалим теперь все непорождающие нетерминалы, и все продукции, где они встречаются: они нам никакой пользы, понятное дело, не дают, их не надо получать.

Теперь еще удалим символы, недостижимые из $S$.

Мы сейчас убрали все бесполезные символы. 
Оставшиеся символы полезные, так как каждый из них и достижим и порождающий, а это равносильно полезности.
Все удаленные символы бесполезные, так как хотя бы одной из двух стрелок для них не существовало.

Размер $\O(|G|)$
\end{enumerate}

\subsection{Нормальная форма Хомского}
\begin{Def}
Про КС-грамматику $G$ говорят, что она в нормальной форме Хомского, когда есть только продукции вида: $A \to BC$ (возможно, либо $B$ либо $C$ совпадает с $A$), при этом все символы "--- полезные.
, $A \to \alpha$, где $\alpha$ "--- терминал.
\end{Def}
\begin{Rem}
В данном формализме нельзя получить пустое слово, можно опять просто сделать новый стартовый символ с продукциями $S' \to S | \epsilon$
\end{Rem}                                                                                                                              

Алгоритм приведения грамматики в нормальную форму Хомского:

\begin{enumerate}
\setcounter{enumi}{-1}
\item
Удаление длинных правых частей.
$A \to B_1 \dots B_k, k \geq 3$. ($B_i \in \Sigma \cup N$) 

Заменим это на $\\
A \to B_1C_1 \\
C_1 \to B_2C_2 \\
\dots \\
C_{k-2} \to B_{k-1}B_k$
                                      
$C_i$ "--- какие-то новые нетерминалы, раньше их не было в грамматике.

\item
Удаление $\epsilon$-продукций. Заметим, кстати, что экспоненциального роста уже не будет "--- все продукции стали короткими.

\item
Удаление цепных продукций.

\item
Удаление бесполезных символов.

\item
Остались только плохие продукции длины 2, у которых в правой части есть и терминал и нетерминал (от длинных избавились, продукции вида $A \to B \in N$ исчезли на втором шаге).

Продукцию $A \to aB$ просто превратим в $\\
A \to XY
X \to a
Y \to b
$

$X, Y$ "--- новые нетерминалы.
Можно еще просто сделать для каждого терминала соответствующий ему нетерминал, а не добавять каждый раз по два новых нетерминала.
\end{enumerate}                        

Для нормальной формы Хомского уже можно написать какой-нибудь алгоритм, проверяющий слово на принадлежность грамматике
\subsection{Проверка принадлежности слова КС-языку}
Алгоритм Кока-Янгера-Касами (CYK)

У нас есть КС-грамматика $G$ в нормальной форме Хомского, есть  какое-то слово $w \in \Sigma^*$, хотим проверить, верно ли, что $w \in L(G)$.
Пусть $|w| = n$. 
У нас будет трехмерная динамика $d_{ijk}$, $i \in [1; n\, j \in [1; n], k \in N$ "--- верно ли, что $k \xLongrightarrow{*} w{i\dots j}$

\begin{enumerate}
\item $i = j$, мы хотим получить однобуквенное слово, $d_{ijk} = \text{true}$, если есть продукция $k \to w_i$.
\item $i \neq j$. 
Если реально получили из $k$ $w_{i \dots j}$, то мы $k$ заменили на два нетерминала $A, B$ При этом, $A$ раскроется в префикс $w_{i \dots j}$, а $B$ "--- в суффикс.

Тогда несложно посчитать $d_{ijk}$: надо просто перебрать $m, A, B$, где $k \to AB$, если $d_{i,m,A} \land d_{m+1,j,B}$, для какого-то $m$, то $d_{ijk} = \text{true}$.

Время работы: $\O(n^3 |G|)$ (цикл по $A, B$ суммарно (суммируем по $k$) будет работать за $|G|$ для фиксированных $i, j, m$).
\end{enumerate}